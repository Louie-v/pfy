/*-----------------------------This for Yezi---------------------------------*/
//first build data:2013-8-27
// Ê¹ÓÃÁ¬Ðø¶Ë¿Ú£¬Î´Ê¹ÓÃÖÐ¶Ï
/*1 28
1+2 27
2+3 26
3+4 25+in3
4+5 24+in2
5+6 23+in1
7 22
8 21
159 20
1610 19+14
6+11 18+13
7+12 17+12
8+13 16+11
9+1415+10
*/
/* I/O: DDRD(11111111)=0xFF Ê¹ÓÃ8Î»
DDRB(XX111111)=0xff Ê¹ÓÃ6Î»
DDRC(XXXXX000)=0x00 Ê¹ÓÃ3Î» ÊäÈë
*/
/*-----------------------------This is end---------------------------------*/


#include <avr/io.h>
// #include <interrupt.h>
// #include <avr/signal.h>
#include <util/delay.h>

//////////////////////////////////////////////////////////////////////////////////////////////////////

const uint16_t data0[] =
    {
        0x10, 0x04, 0x60, 0x04, 0x02, 0x7E, 0x8C, 0x01,
        0x00, 0x80, 0xFE, 0x47, 0x02, 0x30, 0xF2, 0x0F,
        0x02, 0x10, 0xFE, 0x27, 0x00, 0x00, 0xF8, 0x47,
        0x00, 0x80, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, /*"²â",0*/

        0x40,0x00,0x40,0x00,0x42,0x00,0xCC,0x3F,
        0x00,0x10,0x90,0x28,0x90,0x60,0x90,0x3F,
        0x90,0x10,0x90,0x10,0xFF,0x01,0x10,0x0E,
        0x11,0x30,0x16,0x40,0x10,0xF0,0x00,0x00,/*"ÊÔ",1*/
    };

const uint16_t data1[] =
    {
        0x10, 0x04, 0x60, 0x04, 0x02, 0x7E, 0x8C, 0x01,
        0x00, 0x80, 0xFE, 0x47, 0x02, 0x30, 0xF2, 0x0F,
        0x02, 0x10, 0xFE, 0x27, 0x00, 0x00, 0xF8, 0x47,
        0x00, 0x80, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, /*"²â",0*/

        0x40,0x00,0x40,0x00,0x42,0x00,0xCC,0x3F,
        0x00,0x10,0x90,0x28,0x90,0x60,0x90,0x3F,
        0x90,0x10,0x90,0x10,0xFF,0x01,0x10,0x0E,
        0x11,0x30,0x16,0x40,0x10,0xF0,0x00,0x00,/*"ÊÔ",1*/
    };
const uint16_t data2[] =
    {
        0x10, 0x04, 0x60, 0x04, 0x02, 0x7E, 0x8C, 0x01,
        0x00, 0x80, 0xFE, 0x47, 0x02, 0x30, 0xF2, 0x0F,
        0x02, 0x10, 0xFE, 0x27, 0x00, 0x00, 0xF8, 0x47,
        0x00, 0x80, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, /*"²â",0*/

        0x40,0x00,0x40,0x00,0x42,0x00,0xCC,0x3F,
        0x00,0x10,0x90,0x28,0x90,0x60,0x90,0x3F,
        0x90,0x10,0x90,0x10,0xFF,0x01,0x10,0x0E,
        0x11,0x30,0x16,0x40,0x10,0xF0,0x00,0x00,/*"ÊÔ",1*/
    };
//uint8_t count=(sizeof(data)/sizeof(data[0]));//Êý¾Ý³¤¶È£¬ÔÝÊ±²»ÓÃ

//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////

void display(uint8_t dis_date1, uint8_t dis_date2) ///ÏÔÊ¾º¯Êý
{

    //------------------ÏÔÊ¾-------------------//
    PORTD = dis_date1;
    PORTB = dis_date2;
    _delay_ms(2);///////////////////////视觉控制///////////////////////////////////
    //------------------ÏûÓ°-------------------//
    PORTD = 0x00;
    PORTB = 0x00;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
void blink(void)
{
    PORTD = _BV(0);
    _delay_ms(100);
    PORTD = 0x00;
    _delay_ms(100);
}
//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
void port_init(void) ///¶Ë¿Ú³õÊ¼»¯º¯Êý£¬¹²Ê¹ÓÃ19¸ö¶Ë¿Ú 16¸öÊä³ö3¸öÊäÈë
{
    DDRB = 0xFF; ///Ê¹ÓÃPB0~5,¹²6¸ö
    DDRC = 0x00; ///Ê¹ÓÃPC0~1£¬¹²2¸ö
    PORTC = _BV(DDC0) | _BV(DDC1) | _BV(DDC2); //ÊäÈëÉèÖÃ
    DDRD = 0xFF; ///Ê¹ÓÃPD0~7£¬¹²8¸ö

    _delay_ms(300);
    for (int i = 0; i < 6; ++i)
    {
        blink();
    }



}

//////////////////////////////////////////////////////////////////////////////////////////////////////
/*
 
// ISR(INT0_vect)///Íâ²¿ÖÐ¶Ïº¯Êý0///·´ÏòÏÔÊ¾
// {
// for (int i = count; i >= 0; i-=2)
// {
// display(data[i-1],data[i]);
// _delay_ms(2);
// }
// }
 
 
 
// ISR(INT1_vect)///Íâ²¿ÖÐ¶Ïº¯Êý1///ÕýÏòÏÔÊ¾
// {
 
// for (int i = 0; i <= count; i+=2)
// {
// display(data[i],data[i+1]);
// _delay_ms(2);
// }
// }
*/

//////////////////////////////////////////////////////////////////////////////////////////////////////


int main(void)
{
    port_init();
    // MCUCR&=0xf0;
    //GICR=_BV(INT1)|_BV(INT1);
    // sei();
    uint8_t list = 1;
    while (1)
    {

            if (!(PINC&0x01))
            {
                _delay_ms(20);
                while (!(PINC&0x01));

                list++;
                if (list > 4)
                {
                    list = 1;
                }

            }
            if (list == 1) ////////////////////ÏÔÊ¾Êý¾Ý1//////////////////////////////////////
            {
                if (!(PINC&0x02))
                {
                    _delay_ms(20);
                    while (!(PINC&0x02));

                    for (int i = 0; i < 64; i++) ////////jÏÔÊ¾Êý¾Ý³¤¶È////////////////
                    {
                        display(data0[i], data0[i + 1]);
                        i++;
                    }

                }
                if (!(PINC&0x04))
                {
                    _delay_ms(20);
                    while (!(PINC&0x04));

                    for (int i = 63; i >= 0; i--) ////////jÏÔÊ¾Êý¾Ý³¤¶È////////////////
                    {
                        display(data0[i - 1], data0[i]);
                        i--;
                    }

                }
            }
            if (list == 2) ////////////////////ÏÔÊ¾Êý¾Ý2//////////////////////////////////////
            {
                if (!(PINC&0x02))
                {
                    _delay_ms(20);
                    while (!(PINC&0x02));

                    for (int i = 0; i < 64; i++) ////////jÏÔÊ¾Êý¾Ý³¤¶È////////////////
                    {
                        display(data1[i], data1[i + 1]);
                        i++;
                    }

                }
                if (!(PINC&0x04))
                {
                    _delay_ms(20);
                    while (!(PINC&0x04));

                    for (int i = 63; i >= 0; i--) ////////jÏÔÊ¾Êý¾Ý³¤¶È////////////////
                    {
                        display(data1[i - 1], data1[i]);
                        i--;
                    }

                }
            }
            if (list == 3) ////////////////////ÏÔÊ¾Êý¾Ý3//////////////////////////////////////
            {
                if (!(PINC&0x02))
                {
                    _delay_ms(20);
                    while (!(PINC&0x02));

                    for (int i = 0; i < 64; i++) ////////jÏÔÊ¾Êý¾Ý³¤¶È////////////////
                    {
                        display(data2[i], data2[i + 1]);
                        i++;
                    }

                }
                if (!(PINC&0x04))
                {
                    _delay_ms(20);
                    while (!(PINC&0x04));

                    for (int i = 63; i >= 0; i--) ////////jÏÔÊ¾Êý¾Ý³¤¶È////////////////
                    {
                        display(data2[i - 1], data2[i]);
                        i--;
                    }

                }
            }
    }
    return 0;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////